<!-- ============================================================================== -->
<!-- FICHIER ULTIME ET FINAL POUR : templates/objectif_detail.html                  -->
<!-- (Corrige le bug de sécurité CSP)                                             -->
<!-- ============================================================================== -->
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Détail de l'Objectif - {{ objectif.nom }}</title>
    <style> /* ... (vos styles restent les mêmes) ... */ </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <script> if (localStorage.getItem('theme') === 'dark') document.body.classList.add('dark-mode'); </script>
    <div class="container">
        <!-- ... (tout le haut de votre page : titre, stats, etc.) ... -->

        <h2>Évolution de l'épargne</h2>
        <div style="width:100%; margin-top: 20px;">
            <!-- ON AJOUTE 'data-objectif-id' POUR PASSER L'ID AU JAVASCRIPT -->
            <canvas id="evolutionChart" data-objectif-id="{{ objectif.id }}"></canvas>
        </div>

        <!-- ... (le reste de votre page : formulaire, historique, bouton archiver) ... -->
    </div>

    <!-- ON REMPLACE L'ANCIEN SCRIPT EN LIGNE PAR UN LIEN VERS NOTRE NOUVEAU FICHIER -->
    <script src="{{ url_for('static', filename='chart_logic.js') }}"></script>
    <script>
        // On garde uniquement le script de suppression ici
        function confirmerSuppression(objectifId) {
            const confirmation = confirm("Êtes-vous sûr de vouloir supprimer DÉFINITIVEMENT cet objectif ?");
            if (confirmation) {
                const password = prompt("Pour confirmer, veuillez entrer votre mot de passe :");
                if (password !== null) {
                    const form = document.getElementById('form-delete-' + objectifId);
                    form.querySelector('input[name="password"]').value = password;
                    form.submit();
                }
            }
        }
    </script>
</body>
</html>